<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>进无止境&#39;s 博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="进无止境's 博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="进无止境's 博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="进无止境's 博客">
  
    <link rel="alternate" href="/atom.xml" title="进无止境&#39;s 博客" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  

</head>



  <body>


  
    <header id="header">

  
    <div id="intrologo" class="intro-logo">
  

    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      
        function i(){
            x.clearRect(0,0,w,h)
            q=[{x:0,y:h*.7+f},{x:0,y:h*.7-f}]
            while(q[1].x<w+f) d(q[0], q[1])
        }
        function d(i,j){   
            x.beginPath()
            x.moveTo(i.x, i.y)
            x.lineTo(j.x, j.y)
            var k = j.x + (z()*2-0.25)*f,
                n = y(j.y)
            x.lineTo(k, n)
            x.closePath()
            r-=u/-50
            x.fillStyle = '#'+(v(r)*127+128<<16 | v(r+u/3)*127+128<<8 | v(r+u/3*2)*127+128).toString(16)
            x.fill()
            q[0] = q[1]
            q[1] = {x:k,y:n}
        }
        function y(p){
            var t = p + (z()*2-1.1)*f
            return (t>h||t<0) ? y(p) : t
        }
        document.getElementById("intrologo").onclick = i
        document.getElementById("intrologo").ontouchstart = i
        i()
      
    </script>
    

    
      <div id="homelogo" class="homelogo"> 
    

        
          <div class="homelogoback" >
            <h1><a href="#content" id="logo">进无止境&#39;s 博客</a></h1>
            <h3></h3>
            <h5>Jim</h5>
            <!-- <p><a href="https://github.com/iTimeTraveler" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- 自适应主页背景大图 -->
  

 <!-- home_logo_image居中 -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="/">首页</a>
        
          <a id="beautifont" class="main-nav-link" href="/archives">归档</a>
        
          <a id="beautifont" class="main-nav-link" href="/about">关于</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="post-Android_mk"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/12/Android_mk/">Android.mk</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/12/Android_mk/" class="article-date">
	  <time datetime="2017-04-12T04:22:33.000Z" itemprop="datePublished">2017-04-12</time>
	</a>

      
    <a class="article-category-link" href="/categories/Android/">Android</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Android-mk"><a href="#Android-mk" class="headerlink" title="Android.mk"></a>Android.mk</h1>
      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-mk/">Android.mk</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Makefile/">Makefile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-InputSystem001_LinuxInputDriver"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/12/InputSystem001_LinuxInputDriver/">Input系统——Linux驱动</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/12/InputSystem001_LinuxInputDriver/" class="article-date">
	  <time datetime="2017-04-12T04:22:33.000Z" itemprop="datePublished">2017-04-12</time>
	</a>

      
    <a class="article-category-link" href="/categories/Android/">Android</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event/">event</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/input/">input</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/input系统/">input系统</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-InputSystem002_LinuxInputSubSystem"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/12/InputSystem002_LinuxInputSubSystem/">Input系统——Linux 输入子系统</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/12/InputSystem002_LinuxInputSubSystem/" class="article-date">
	  <time datetime="2017-04-12T04:22:33.000Z" itemprop="datePublished">2017-04-12</time>
	</a>

      
    <a class="article-category-link" href="/categories/Android/">Android</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>待整理完善。。。</p>
<h3 id="1-struct-input-dev"><a href="#1-struct-input-dev" class="headerlink" title="1. struct input_dev"></a>1. struct input_dev</h3><pre><code>struct input_dev {
    const char *name; //名字 
    const char *phys;
    const char *uniq;
    struct input_id id;

    unsigned long propbit[BITS_TO_LONGS(INPUT_PROP_CNT)];

    unsigned long evbit[BITS_TO_LONGS(EV_CNT)];    // 设备所支持的事件类型

    unsigned long keybit[BITS_TO_LONGS(KEY_CNT)];  // 按键类型 
    unsigned long relbit[BITS_TO_LONGS(REL_CNT)];  // 相对值类型
    unsigned long absbit[BITS_TO_LONGS(ABS_CNT)];  // 绝对值类型
    unsigned long mscbit[BITS_TO_LONGS(MSC_CNT)];  // 混合类型
    unsigned long ledbit[BITS_TO_LONGS(LED_CNT)];  // LED类型
    unsigned long sndbit[BITS_TO_LONGS(SND_CNT)];  // 声音类型
    unsigned long ffbit[BITS_TO_LONGS(FF_CNT)];    // 力反馈
    unsigned long swbit[BITS_TO_LONGS(SW_CNT)];    // 开关类型???

    unsigned int hint_events_per_packet;

    unsigned int keycodemax;
    unsigned int keycodesize;
    void *keycode;

    int (*setkeycode)(struct input_dev *dev,
              const struct input_keymap_entry *ke,
              unsigned int *old_keycode);
    int (*getkeycode)(struct input_dev *dev,
              struct input_keymap_entry *ke);

    struct ff_device *ff;

    unsigned int repeat_key;
    struct timer_list timer;

    int rep[REP_CNT];

    struct input_mt *mt;

    struct input_absinfo *absinfo;

    unsigned long key[BITS_TO_LONGS(KEY_CNT)];
    unsigned long led[BITS_TO_LONGS(LED_CNT)];
    unsigned long snd[BITS_TO_LONGS(SND_CNT)];
    unsigned long sw[BITS_TO_LONGS(SW_CNT)];

    int (*open)(struct input_dev *dev);
    void (*close)(struct input_dev *dev);
    int (*flush)(struct input_dev *dev, struct file *file);
    int (*event)(struct input_dev *dev, unsigned int type, unsigned int code, int value);

    struct input_handle __rcu *grab;

    spinlock_t event_lock;
    struct mutex mutex;

    unsigned int users;
    bool going_away;

    struct device dev;

    struct list_head    h_list;
    struct list_head    node;

    unsigned int num_vals;
    unsigned int max_vals;
    struct input_value *vals;

    bool devres_managed;
};
</code></pre><h3 id="2-注册-注销函数"><a href="#2-注册-注销函数" class="headerlink" title="2. 注册/注销函数"></a>2. 注册/注销函数</h3><pre><code>int input_register_device搜索(struct input_dev *dev)
void input_unregister_device(struct input_dev *dev)
</code></pre><h3 id="3-设备所支持的事件类型有"><a href="#3-设备所支持的事件类型有" class="headerlink" title="3. 设备所支持的事件类型有"></a>3. 设备所支持的事件类型有</h3><pre><code>EV_KEY 按键
EV_REL 相对坐标
EV_ABS绝对坐标
EV_MSC 其它
EV_LED LED
EV_SND 声音
EV_FF 力反馈
EV_SW 开关???
</code></pre><h3 id="4-操作函数"><a href="#4-操作函数" class="headerlink" title="4. 操作函数"></a>4. 操作函数</h3><pre><code>set_bit(EV_KEY, button_dev.evbit)   // 设置支持的事件
void input_report_key(struct input_dev *dev,unsigned int code, int value)   // 在中断过程中中，内核层使用input_report_key等函数向用户空间报告，然后应用程序读取状态。
void input_report_rel(struct input_dev *dev,unsigned int code, int value)   // ..
void input_report_abs(struct input_dev *dev,unsigned int code, int value)   // ..
input_sync()  // 用于事件同步，它告知事件的接收者：驱动已经发出了一个完整的报告。
</code></pre><h3 id="5-事件代码"><a href="#5-事件代码" class="headerlink" title="5. 事件代码"></a>5. 事件代码</h3><p>EV_KEY 事件代码</p>
<pre><code>代码值0~127为键盘上的按键代码，0x110~0x116为鼠标上按键代码，其中0x110(BTN_LEFT)为鼠标左键，0x111(BTN_RIGHT)为鼠标右键,0x112(BTN_ MIDDLE)为鼠标中键。其它代码含义请参看include/linux/input.h文件
</code></pre><p>EV_KEY 事件值</p>
<pre><code>按键按下时值为1,松开时值为0
</code></pre><h3 id="evdev"><a href="#evdev" class="headerlink" title="evdev"></a>evdev</h3>
      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event/">event</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/input/">input</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/input系统/">input系统</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-InputSystem003_AndroidInputSystem"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/12/InputSystem003_AndroidInputSystem/">Input系统——Android Input系统</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/12/InputSystem003_AndroidInputSystem/" class="article-date">
	  <time datetime="2017-04-12T04:22:33.000Z" itemprop="datePublished">2017-04-12</time>
	</a>

      
    <a class="article-category-link" href="/categories/Android/">Android</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Input系统结构解析"><a href="#Input系统结构解析" class="headerlink" title="Input系统结构解析"></a>Input系统结构解析</h1><p>AndroidInput系统——JNI NativeInputManager InputManger InputReader<br><a href="https://docs.google.com/drawings/d/1DoS3SayZNpAqAMpjQ8h0O1eSb1nb9r9V7c47TjvqO2o/edit" target="_blank" rel="external">https://docs.google.com/drawings/d/1DoS3SayZNpAqAMpjQ8h0O1eSb1nb9r9V7c47TjvqO2o/edit</a><br><img src="https://docs.google.com/drawings/d/1DoS3SayZNpAqAMpjQ8h0O1eSb1nb9r9V7c47TjvqO2o/pub?w=998&amp;h=918" alt="AndroidInput系统——JNI NativeInputManager InputManger InputReader"></p>
<p>AndroidInput系统——InputReader<br><a href="https://docs.google.com/drawings/d/1A78eIrYTHg2nh-HrWJMpsMu64HitGj7dk_ciSajtex4/edit" target="_blank" rel="external">https://docs.google.com/drawings/d/1A78eIrYTHg2nh-HrWJMpsMu64HitGj7dk_ciSajtex4/edit</a><br><img src="https://docs.google.com/drawings/d/1A78eIrYTHg2nh-HrWJMpsMu64HitGj7dk_ciSajtex4/pub?w=982&amp;h=726" alt="AndroidInput系统——InputReader "></p>
<p>AndroidInput系统——InputDispatcher<br><a href="https://docs.google.com/drawings/d/19KStX_1m2rNCqjCouwW5DFWOY-e1ZbfDTcYAXrPSzOA/edit" target="_blank" rel="external">https://docs.google.com/drawings/d/19KStX_1m2rNCqjCouwW5DFWOY-e1ZbfDTcYAXrPSzOA/edit</a><br><img src="https://docs.google.com/drawings/d/19KStX_1m2rNCqjCouwW5DFWOY-e1ZbfDTcYAXrPSzOA/pub?w=960&amp;h=720" alt="AndroidInput系统——InputDispatcher "></p>
<p>AndroidInput系统——EventHub<br><a href="https://docs.google.com/drawings/d/1QAC0GFiARVOJcv6vugVNEiqIMkGZX0XXhiCuIDssvtk/edit" target="_blank" rel="external">https://docs.google.com/drawings/d/1QAC0GFiARVOJcv6vugVNEiqIMkGZX0XXhiCuIDssvtk/edit</a><br><img src="https://docs.google.com/drawings/d/1QAC0GFiARVOJcv6vugVNEiqIMkGZX0XXhiCuIDssvtk/pub?w=960&amp;h=720" alt="AndroidInput系统——EventHub"></p>
<h1 id="Android-Input系统相关结构体"><a href="#Android-Input系统相关结构体" class="headerlink" title="Android Input系统相关结构体"></a>Android Input系统相关结构体</h1><h3 id="1-input-device-id"><a href="#1-input-device-id" class="headerlink" title="1. input_device_id"></a>1. input_device_id</h3><pre><code>struct input_device_id {
 kernel_ulong_t flags;
 __u16 bustype;  // BUS_USB  BUS_BLUETOOTH  
 __u16 vendor;
 __u16 product;
 __u16 version;
 kernel_ulong_t evbit[INPUT_DEVICE_ID_EV_MAX / BITS_PER_LONG + 1];

 kernel_ulong_t keybit[INPUT_DEVICE_ID_KEY_MAX / BITS_PER_LONG + 1];
 kernel_ulong_t relbit[INPUT_DEVICE_ID_REL_MAX / BITS_PER_LONG + 1];
 kernel_ulong_t absbit[INPUT_DEVICE_ID_ABS_MAX / BITS_PER_LONG + 1];
 kernel_ulong_t mscbit[INPUT_DEVICE_ID_MSC_MAX / BITS_PER_LONG + 1];
 kernel_ulong_t ledbit[INPUT_DEVICE_ID_LED_MAX / BITS_PER_LONG + 1];
 kernel_ulong_t sndbit[INPUT_DEVICE_ID_SND_MAX / BITS_PER_LONG + 1];
 kernel_ulong_t ffbit[INPUT_DEVICE_ID_FF_MAX / BITS_PER_LONG + 1];
 kernel_ulong_t swbit[INPUT_DEVICE_ID_SW_MAX / BITS_PER_LONG + 1];
 kernel_ulong_t driver_info;
};
</code></pre><h3 id="2-input-event-input-h"><a href="#2-input-event-input-h" class="headerlink" title="2. input_event (input.h)"></a>2. input_event (input.h)</h3><pre><code>struct input_event {
    struct timeval time;
    __u16 type;
    __u16 code;
    __s32 value;
};
</code></pre><h3 id="3-RawEvent-EventHub-h"><a href="#3-RawEvent-EventHub-h" class="headerlink" title="3. RawEvent (EventHub.h)"></a>3. RawEvent (EventHub.h)</h3><pre><code>struct RawEvent {
    nsecs_t when;       time
    int32_t deviceId;   ID    = 1       ID         = 0
    int32_t type;       EV_REL= 0x02    EV_SYN     = 0x00
    int32_t code;       REL_X = 0x00    SYN_REPORT = 0
    int32_t value;      Value = 0x01    Value      = 0x00
};
</code></pre><h1 id="调试相关"><a href="#调试相关" class="headerlink" title="调试相关"></a>调试相关</h1><h3 id="查看event注册设备"><a href="#查看event注册设备" class="headerlink" title="查看event注册设备"></a>查看event注册设备</h3><pre><code>shell@rk3368_32:/dev/input # cat /proc/bus/input/devices
I: Bus=0000 Vendor=0000 Product=0003 Version=206a
N: Name=&quot;synaptics_dsx&quot;
P: Phys=synaptics_dsx/touch_input
S: Sysfs=/devices/ff140000.i2c/i2c-2/2-0020/input/input0
U: Uniq=
H: Handlers=event0 cpufreq ddr_freq 
B: PROP=2
B: EV=b
B: KEY=420 0 0 0 0 0 8000 0 0 0 0
B: ABS=2638000 3

I: Bus=0019 Vendor=0000 Product=0000 Version=0000
N: Name=&quot;rotary.35&quot;
P: Phys=
S: Sysfs=/devices/rotary.35/input/input1
U: Uniq=
H: Handlers=event1 
B: PROP=0
B: EV=5
B: REL=1

I: Bus=0019 Vendor=0001 Product=0001 Version=0100
N: Name=&quot;rk29-keypad&quot;
P: Phys=gpio-keys/input0
S: Sysfs=/devices/ff100000.adc/key.38/input/input2
U: Uniq=
H: Handlers=event2 ddr_freq keychord 
B: PROP=0
B: EV=3
B: KEY=8000 100000 0 0 0

I: Bus=0000 Vendor=0000 Product=0000 Version=0000
N: Name=&quot;temperature&quot;
P: Phys=
S: Sysfs=/devices/ff160000.i2c/i2c-4/4-005b/input/input3
U: Uniq=
H: Handlers=event3 
B: PROP=0
B: EV=9
B: ABS=40
</code></pre><h3 id="查看Handler个数"><a href="#查看Handler个数" class="headerlink" title="查看Handler个数"></a>查看Handler个数</h3><pre><code>shell@rk3368_box:/dev/input # ls -l                                            
crw-rw---- root     input     13,  64 2017-04-12 11:15 event0
crw-rw---- root     input     13,  65 2017-04-12 11:15 event1
crw-rw---- root     input     13,  66 2017-04-14 08:12 event2
crw-rw---- root     input     13,  67 2017-04-14 08:12 event3

cat event0 
cat event1
</code></pre><h3 id="getevent-获取事件"><a href="#getevent-获取事件" class="headerlink" title="getevent 获取事件"></a>getevent 获取事件</h3><pre><code># getevent -h
Usage: getevent [-t] [-n] [-s switchmask] [-S] [-v [mask]] [-d] [-p] [-i] [-l] [-q] [-c count] [-r] [device]
    -t: show time stamps
    -n: don&apos;t print newlines
    -s: print switch states for given bits
    -S: print all switch states
    -v: verbosity mask (errs=1, dev=2, name=4, info=8, vers=16, pos. events=32, props=64)
    -d: show HID descriptor, if available
    -p: show possible events (errs, dev, name, pos. events)
    -i: show all device info and possible events
    -l: label event types and names in plain text
    -q: quiet (clear verbosity mask)
    -c: print given number of events then exit
    -r: print rate events are received

常用命令组合：
    getevent -p    // see all of the keys and axes a device reports
    getevent -ip   // get more information, including HID mapping tables and debugging information
    getevent -lp   // option to display textual labels for all event codes
    getevent -lp
    getevent -r -q    监控设备的sendevent事件 


getevent -p             
add device 1: /dev/input/event3
  name:     &quot;temperature&quot;
add device 2: /dev/input/event1
  name:     &quot;rotary.35&quot;
add device 3: /dev/input/event0
  name:     &quot;synaptics_dsx&quot;
add device 4: /dev/input/event2
  name:     &quot;rk29-keypad&quot;

/dev/input/event1: 0002 0000 00000001   ID=1    EV_REL=0x02   REL_X = 0x00    Value = 0x01
/dev/input/event1: 0000 0000 00000000   ID=0    EV_SYN 0x00   SYN_REPORT = 0  Value = 0x00
/dev/input/event1: 0002 0000 00000001       
/dev/input/event1: 0000 0000 00000000       
/dev/input/event1: 0002 0000 00000001
/dev/input/event1: 0000 0000 00000000
/dev/input/event1: 0002 0000 ffffffff       EV_REL=0x02   REL_X = 0x00    Value = 0xffffffffff
/dev/input/event1: 0000 0000 00000000
/dev/input/event1: 0002 0000 ffffffff
</code></pre><h3 id="dumpsys"><a href="#dumpsys" class="headerlink" title="dumpsys"></a>dumpsys</h3><p>  dumpsys input：<br>    To dump the input system’s state (Event Hub State,Input Reader State,Input Dispatcher State)</p>

      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event/">event</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/input/">input</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/input系统/">input系统</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-InputSystem005_ExampleAPP"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/12/InputSystem005_ExampleAPP/">Input系统——APP事件监听及处理</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/12/InputSystem005_ExampleAPP/" class="article-date">
	  <time datetime="2017-04-12T04:22:33.000Z" itemprop="datePublished">2017-04-12</time>
	</a>

      
    <a class="article-category-link" href="/categories/Android/">Android</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>InputDevice<br><a href="https://developer.android.com/reference/android/view/InputDevice.html" target="_blank" rel="external">https://developer.android.com/reference/android/view/InputDevice.html</a></p>
<p>android.support.wearable 包</p>
<p><a href="http://stackoverflow.com/questions/24520240/import-android-support-wearable-cannot-be-resolved" target="_blank" rel="external">http://stackoverflow.com/questions/24520240/import-android-support-wearable-cannot-be-resolved</a></p>

      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/APP/">APP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/input/">input</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/input系统/">input系统</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-InputSystem004_type_code"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/12/InputSystem004_type_code/">Input系统——TYPE CODE</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/12/InputSystem004_type_code/" class="article-date">
	  <time datetime="2017-04-12T04:22:33.000Z" itemprop="datePublished">2017-04-12</time>
	</a>

      
    <a class="article-category-link" href="/categories/Android/">Android</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Event-Type-amp-Code"><a href="#Event-Type-amp-Code" class="headerlink" title="Event Type&amp;Code"></a>Event Type&amp;Code</h1><pre><code>EV_SYN:  - 用于事件间的分割标志。事件可能按时间或空间进行分割，就像在多点触摸协议中的例子。
    SYN_REPORT:    - 当多个输入数据在同一时间发生变化时，SYN_REPORT用于把这些数据进行打包和包同步。
                例如，一次鼠标的移动可以上报   REL_X和REL_Y两个数值，然后发出一个SYN_REPORT。
                下一次鼠标移动可以再次发出REL_X和REL_Y两个数值，然后经跟这另一个SYN_REPORT。

    SYN_MT_REPORT: - 用于同步和分离触摸事件
    SYN_DROPPED:   - 用来指出evdev客户的事件队列的的缓冲区溢出。

EV_KEY:  - 用来描述键盘，按键或者类似键盘设备的状态变化。
    KEY_&lt;name&gt;:    - EV_KEY事件采取KEY_&lt;name&gt; 或BTN_&lt;name&gt;的形式，
                        比如，KEY_A代表键盘上的A键，当一个按键被按下时，一个带有按键编码和value为1的事件被发出。
                        当一个按键被释放时，一个value为0的事件被发出。有些硬件当按键重复时会发出事件，这些事件的value值为2。
                        通常，KEY_&lt;name&gt;用作键盘上的按键，而BTN_&lt;name&gt;则用于开关按钮事件。 
                   - 普通键盘按键     0x0~0x100     0x160~0x2ff
                   - 游戏柄的按键     0x100~0x110   0x120~0x140
                   - 鼠标按键         BTN_MOUSE-BTN_LEFT-0x110-左键；  BTN_RIGHT-0x111-右键；  BTN_MIDDLE-0x112-中键；
    BTN_&lt;name&gt;:    - see above

EV_REL:  - 用来描述相对坐标轴上数值的变化，例如：鼠标向左方移动了5个单位。
    REL_X 0x00      //X 轴
    REL_Y 0x01      //Y 轴
    REL_Z 0x02      //Z 轴
    REL_RX 0x03
    REL_RY 0x04
    REL_RZ 0x05
    REL_HWHEEL 0x06 //水平方向horizontal的滚轮
    REL_DIAL 0x07
    REL_WHEEL 0x08  //垂直方向vertical的滚轮
    REL_MISC 0x09
    REL_MAX 0x0f
    REL_CNT (REL_MAX+1)

EV_ABS:  - 用来描述相对坐标轴上数值的变化，例如：描述触摸屏上坐标的值。
    ABS_X 0x00
    ABS_Y 0x01
    ABS_Z 0x02
    ABS_RX 0x03
    ABS_RY 0x04
    ABS_RZ 0x05
    ABS_THROTTLE 0x06
    ABS_RUDDER 0x07
    ABS_WHEEL 0x08
    ABS_GAS 0x09
    ABS_BRAKE 0x0a
    ABS_DISTANCE 0x19 - 用来描述触摸工具离触摸表面的距离
    ABS_MT_&lt;name&gt; 用于描述多手指触摸输入设备。详情请参考内核文档：multi-touch-protocol.txt。

EV_MSC:  - 当不能匹配现有的类型时，使用该类型进行描述。
EV_SW:   - 用来描述具备两种状态的输入开关。
    SW_LID 0x00  用来指出笔记本电脑的屏幕是否合上

EV_LED:  - 用于设置或查询设备上的LED灯的开和关。
EV_SND:  - 用来给设备输出提示声音。
EV_REP:  - 用于可以自动重复的设备（autorepeating）。
EV_FF:   - 用来给输入设备发送强制回馈命令。（震动？）
    FF_RUMBLE 0x50
    FF_CONSTANT 0x52

EV_PWR:  - 特别用于电源开关的输入。.
EV_FF_STATUS:  - 用于接收设备的强制反馈状态。
</code></pre><h1 id="INPUT-DEVICE-ClASS-来区分"><a href="#INPUT-DEVICE-ClASS-来区分" class="headerlink" title="INPUT_DEVICE_ClASS 来区分"></a>INPUT_DEVICE_ClASS 来区分</h1><pre><code>INPUT_DEVICE_CLASS_CURSOR  
    有BTN_MOUSE按钮 且 REL_X及REL_Y 

INPUT_DEVICE_CLASS_TOUCH | INPUT_DEVICE_CLASS_TOUCH_MT 
    有BTN_TOUCH  ABS_MT_POSITION_X ABS_MT_POSITION_Y 且没有游戏键

INPUT_DEVICE_CLASS_JOYSTICK 


INPUT_DEVICE_CLASS_SWITCH
    任一个即可


INPUT_DEVICE_CLASS_VIBRATOR
    有FF_RUMBLE-0x50
</code></pre><h1 id="TOOL-TYPE"><a href="#TOOL-TYPE" class="headerlink" title="TOOL_TYPE"></a>TOOL_TYPE</h1><pre><code>AMOTION_EVENT_TOOL_TYPE_UNKNOWN 0
    类型未知，或者都无关联项，例如 trackball or other non-pointing device.
AMOTION_EVENT_TOOL_TYPE_FINGER  1
    The tool is a finger 触摸类工具
AMOTION_EVENT_TOOL_TYPE_STYLUS  2
    类似触针类工具，例如手写笔等
AMOTION_EVENT_TOOL_TYPE_MOUSE   3
    The tool is a mouse or trackpad.  鼠标或者触摸板
AMOTION_EVENT_TOOL_TYPE_ERASER  4
    The tool is an eraser or a stylus being used in an inverted posture. 擦除类工具，或者一类反向针式工具
</code></pre><h1 id="MotionEvent"><a href="#MotionEvent" class="headerlink" title="MotionEvent"></a>MotionEvent</h1><pre><code>用于报告运动事件，例如 mouse, pen, finger, trackball 
Motion events may hold either absolute or relative movements and other data, depending on the type of device.

ACTION_BUTTON_PRESS
ACTION_BUTTON_RELEASE
ACTION_CANCEL  // The current gesture has been aborted.
ACTION_SCROLL  // The motion event contains relative vertical and/or horizontal scroll offsets.
ACTION_UP      // 
AXIS_SCROLL    // Generic scroll axis of a motion event.
</code></pre><h1 id="AINPUT-SOURCE"><a href="#AINPUT-SOURCE" class="headerlink" title="AINPUT_SOURCE"></a>AINPUT_SOURCE</h1><pre><code>基本类型
AINPUT_SOURCE_CLASS_MASK        0x000000ff      //         
AINPUT_SOURCE_UNKNOWN           0x00000000      // 
AINPUT_SOURCE_CLASS_BUTTON      0x00000001      // 输入设备有按钮和键
AINPUT_SOURCE_CLASS_POINTER     0x00000002      // 与显示相关的指针式设备
AINPUT_SOURCE_CLASS_NAVIGATION  0x00000004      // 
AINPUT_SOURCE_CLASS_TRACKBALL   0x00000004      // 轨迹导航设备
AINPUT_SOURCE_CLASS_POSITION    0x00000008      // 绝对定位设备（与显示无关的定位）
AINPUT_SOURCE_CLASS_JOYSTICK    0x00000010      // 
AINPUT_SOURCE_CLASS_NONE        0x00000000      // joystick 操作杆，绝对运动

衍生类型
AINPUT_SOURCE_KEYBOARD          0x00000101      // 
AINPUT_SOURCE_DPAD              0x00000201      // 
AINPUT_SOURCE_GAMEPAD           0x00000401      // 
AINPUT_SOURCE_TOUCHSCREEN       0x00001002      // 
AINPUT_SOURCE_MOUSE             0x00002002      // 
AINPUT_SOURCE_STYLUS            0x00004002      //
AINPUT_SOURCE_BLUETOOTH_STYLUS  0x0000c002      // 蓝牙指针，蓝牙鼠标?   API 23
AINPUT_SOURCE_TRACKBALL         0x00010004      // 
AINPUT_SOURCE_MOUSE_RELATIVE    0x00020004      // Android O Developer Preview
AINPUT_SOURCE_TOUCHPAD          0x00100008      //
AINPUT_SOURCE_TOUCH_NAVIGATION  0x00200000      // 
AINPUT_SOURCE_ROTARY_ENCODER    0x00400000      // Android O Developer Preview  
AINPUT_SOURCE_JOYSTICK          0x01000010      // 
AINPUT_SOURCE_HDMI              0x02000001      // 
AINPUT_SOURCE_ANY               0xffffff00      //
</code></pre><h1 id="AINPUT-KEYBOARD-TYPE"><a href="#AINPUT-KEYBOARD-TYPE" class="headerlink" title="AINPUT_KEYBOARD_TYPE"></a>AINPUT_KEYBOARD_TYPE</h1><pre><code>AINPUT_KEYBOARD_TYPE_NONE 0                     // There is no keyboard
AINPUT_KEYBOARD_TYPE_NON_ALPHABETIC 1           // The keyboard supports a complement of alphabetic keys.
AINPUT_KEYBOARD_TYPE_ALPHABETIC 2               // The keyboard is not fully alphabetic
</code></pre><h1 id="Input-device-configuration-idc"><a href="#Input-device-configuration-idc" class="headerlink" title="Input device configuration (.idc)"></a>Input device configuration (.idc)</h1><p>  Input device configuration files (.idc files) contain device-specific configuration properties that affect the behavior of input devices.</p>
<p>  <strong>Location</strong><br>    /system/usr/idc/  or   /data/system/devices/idc/</p>
<p>  <strong>idc文件example如下</strong></p>
<pre><code># This is an example of an input device configuration file.
# It might be used to describe the characteristics of a built-in touch screen.

# This is an internal device, not an external peripheral attached to the USB
# or Bluetooth bus.
device.internal = 1

# The device should behave as a touch screen, which uses the same orientation
# as the built-in display.
touch.deviceType = touchScreen
touch.orientationAware = 1

# Additional calibration properties...
keyboard.layout = qwerty
keyboard.characterMap = qwerty
keyboard.orientationAware = 1
keyboard.builtIn = 1

cursor.mode = navigation
cursor.orientationAware = 1
</code></pre><p>  <strong>Common属性语法</strong></p>
<pre><code>device.internal // Specifies whether the input device is an internal built-in component 
                    as opposed to an externally attached (most likely removable) peripheral.
                    If the value is 0, the device is external.
                    If the value is 1, the device is internal.
                    If the value is not specified, the default value is 0 for all devices on the USB (BUS_USB) or Bluetooth (BUS_BLUETOOTH) bus, 1 otherwise.

                    This property determines default policy decisions regarding wake events.
</code></pre><h1 id="Key-Layout-Files-kl"><a href="#Key-Layout-Files-kl" class="headerlink" title="Key Layout Files (.kl)"></a>Key Layout Files (.kl)</h1><p>  详见 <a href="https://source.android.com/devices/input/key-layout-files" target="_blank" rel="external">https://source.android.com/devices/input/key-layout-files</a> </p>
<pre><code>Key layout files (.kl files) map Linux key codes and axis codes to Android key codes and axis codes and specify associated policy flags. Device-specific key layout files are:

Required for internal (built-in) input devices with keys, including special keys such as volume, power, and headset media keys.
Optional for other input devices but recommended for special-purpose keyboards and joysticks.
If no device-specific key layout file is available, the system chooses a default instead.
</code></pre><h3 id="Location"><a href="#Location" class="headerlink" title="Location"></a>Location</h3><p>  /system/usr/keylayout/ or /data/system/devices/keylayout/</p>
<h3 id="Generic-Key-Layout-File"><a href="#Generic-Key-Layout-File" class="headerlink" title="Generic Key Layout File"></a>Generic Key Layout File</h3><p>  The system provides a special built-in generic key layout file called Generic.kl. This key layout is intended to support a variety of standard external keyboards and joysticks. Do not modify the generic key layout!</p>
<h3 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h3><p>  A key layout file is a plain text file consisting of key or axis declarations and flags.</p>
<p>  <strong>Key Declarations</strong><br>    key         Linux key code number               Android key code name<br>    key usage   HID usage(Hex 32-bit integer)       Android key code name</p>
<p>  <strong>Axis Declarations</strong><br>    axis        Linux axis code number              Android axis code name<br>    Basic Axes<br>    Split Axes<br>    Inverted Axes<br>    Center Flat Position Option</p>
<p>  <strong>Comments</strong><br>    Comment lines begin with # and continue to the end of the line:<br>    <code># A comment!</code></p>
<p>  <strong>Examples</strong> </p>
<pre><code>-- Keyboard --
key 1     ESCAPE
key 2     1
key 3     2
key 4     3
key 5     4
key 6     5
key 7     6
key 8     7
key 9     8
key 10    9
key 11    0
key 12    MINUS
key 13    EQUALS
key 14    DEL

-- System Controls --
# This is an example of a key layout file for basic system controls,
# such as volume and power keys which are typically implemented as GPIO pins
# the device decodes into key presses.

key 114   VOLUME_DOWN
key 115   VOLUME_UP
key 116   POWER

-- Capacitive Buttons -- 
# This is an example of a key layout file for a touch device with capacitive buttons.
key 139    MENU           VIRTUAL
key 102    HOME           VIRTUAL
key 158    BACK           VIRTUAL
key 217    SEARCH         VIRTUAL

-- Headset Jack Media Controls --
# This is an example of a key layout file for headset mounted media controls.
# A typical headset jack interface might have special control wires or detect known
# resistive loads as corresponding to media functions or volume controls.
# This file assumes that the driver decodes these signals and reports media
# controls as key presses.
key 163   MEDIA_NEXT
key 165   MEDIA_PREVIOUS
key 226   HEADSETHOOK

-- Joystick --
# This is an example of a key layout file for a joystick.

# These are the buttons that the joystick supports, represented as keys.
key 304   BUTTON_A
key 305   BUTTON_B
key 307   BUTTON_X
key 308   BUTTON_Y
key 310   BUTTON_L1
key 311   BUTTON_R1
key 314   BUTTON_SELECT
key 315   BUTTON_START
key 316   BUTTON_MODE
key 317   BUTTON_THUMBL
key 318   BUTTON_THUMBR

# Left and right stick.
# The reported value for flat is 128 in a range of -32767 to 32768, which is absurd.
# This confuses applications that rely on the flat value because the joystick
# actually settles in a flat range of +/- 4096 or so. We override it here.
axis 0x00 X flat 4096
axis 0x01 Y flat 4096
axis 0x03 Z flat 4096
axis 0x04 RZ flat 4096

# Triggers.
axis 0x02 LTRIGGER
axis 0x05 RTRIGGER

# Hat.
axis 0x10 HAT_X
axis 0x11 HAT_Y
</code></pre><h3 id="Virtual-Soft-Keys"><a href="#Virtual-Soft-Keys" class="headerlink" title="Virtual Soft Keys"></a>Virtual Soft Keys</h3><p>  // to do</p>
<h3 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a>Validation</h3><p>  You should validate your key layout files using the Validate Keymaps tool.</p>
<h1 id="Key-Character-Map-Files-kcm"><a href="#Key-Character-Map-Files-kcm" class="headerlink" title="Key Character Map Files (.kcm)"></a>Key Character Map Files (.kcm)</h1><p>  Key character map files (.kcm files) are responsible for mapping combinations of Android key codes with modifiers to Unicode characters.</p>
<p>  <strong>Location</strong><br>    /system/usr/keychars/<br>    /data/system/devices/keychars/</p>
<p>  <strong>Generic Key Character Map File</strong><br>    Generic.kcm</p>
<p>  <strong>Virtual Key Character Map File</strong><br>    Virtual.kcm</p>
<p>  <strong>Syntax</strong><br>    Keyboard Type Declaration<br>    Key Declarations<br>    Comments</p>
<h1 id="Keyboard-Devices"><a href="#Keyboard-Devices" class="headerlink" title="Keyboard Devices"></a>Keyboard Devices</h1><h1 id="Touch-Devices"><a href="#Touch-Devices" class="headerlink" title="Touch Devices"></a>Touch Devices</h1><h1 id="附1："><a href="#附1：" class="headerlink" title="附1："></a>附1：</h1><p>HID号码即Hidden ID code 隐含码；<br>PID号码即Public ID code 公开码。</p>
<h1 id="附2-参考资料"><a href="#附2-参考资料" class="headerlink" title="附2(参考资料)"></a>附2(参考资料)</h1><p><a href="https://source.android.com/devices/input/overview" target="_blank" rel="external">https://source.android.com/devices/input/overview</a><br><a href="https://www.kernel.org/doc/Documentation/input/event-codes.txt" target="_blank" rel="external">https://www.kernel.org/doc/Documentation/input/event-codes.txt</a><br><a href="https://www.kernel.org/doc/Documentation/input/input.txt" target="_blank" rel="external">https://www.kernel.org/doc/Documentation/input/input.txt</a><br><a href="https://www.kernel.org/doc/Documentation/input/multi-touch-protocol.txt" target="_blank" rel="external">https://www.kernel.org/doc/Documentation/input/multi-touch-protocol.txt</a><br><a href="https://developer.android.com/reference/android/support/wearable/input/RotaryEncoder.html" target="_blank" rel="external">https://developer.android.com/reference/android/support/wearable/input/RotaryEncoder.html</a></p>

      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event/">event</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/input/">input</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/input系统/">input系统</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-Android编译系统——system.img userdata.img recovery.img目标编译过程"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/11/Android编译系统——system.img userdata.img recovery.img目标编译过程/">Android编译系统——ramdisk.img system.img userdata.img recovery.img目标编译过程</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/11/Android编译系统——system.img userdata.img recovery.img目标编译过程/" class="article-date">
	  <time datetime="2017-04-11T09:35:57.000Z" itemprop="datePublished">2017-04-11</time>
	</a>

      
    <a class="article-category-link" href="/categories/Android/">Android</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="image-介绍"><a href="#image-介绍" class="headerlink" title="image 介绍"></a>image 介绍</h2><pre><code>boot.img      Android 的初始文件映像，负责初始化并加载 system 分区，一般Android系统这个镜像中包含ramdisk.img根文件系统+kernel（RK平台的boot.img是没包含kernel部分的）
recovery.img  恢复模式系统启动镜像。内容和boot.img雷同（RK平台recovery.img包含kernel部分），但是其中的ramdisk.img（ramdisk-recovery.img）有些许不同：
              recovery.fstab文件、sbin下部分工具、build.prop、init.bootmode.emmc.rc、sepolicy等

ramdisk.img   是根文件系统，是root目录打包成的镜像（ramdisk-recovery.img）
system.img    包括了主要的包、库等文件
userdata.img  包括了一些用户数据
</code></pre><h2 id="image-目标编译过程"><a href="#image-目标编译过程" class="headerlink" title="image 目标编译过程"></a>image 目标编译过程</h2><pre><code>---build/core/main.mk中---
默认目标，即目标all
.PHONY: droid
DEFAULT_GOAL := droid
$(DEFAULT_GOAL):             //root目标droid

droid: droidcore dist_files  //1级目标，droidcore

droidcore: files \             //2级目标，files systemimage ...
    systemimage \
    $(INSTALLED_BOOTIMAGE_TARGET) \
    $(INSTALLED_RECOVERYIMAGE_TARGET) \
    $(INSTALLED_USERDATAIMAGE_TARGET) \
    $(INSTALLED_CACHEIMAGE_TARGET) \
    $(INSTALLED_VENDORIMAGE_TARGET) \
    $(INSTALLED_FILES_FILE)

---build/core/Makefile中---
INSTALLED_SYSTEMIMAGE := $(PRODUCT_OUT)/system.img
BUILT_SYSTEMIMAGE := $(systemimage_intermediates)/system.img
FULL_SYSTEMIMAGE_DEPS := $(INTERNAL_SYSTEMIMAGE_FILES) $(INTERNAL_USERIMAGES_DEPS)
INSTALLED_FILES_FILE := $(PRODUCT_OUT)/installed-files.txt


systemimage: $(INSTALLED_SYSTEMIMAGE)        //3级目标 ./system.img

$(INSTALLED_SYSTEMIMAGE): $(BUILT_SYSTEMIMAGE) $(RECOVERY_FROM_BOOT_PATCH) | $(ACP)    //4级目标  _./system.img

$(BUILT_SYSTEMIMAGE): $(FULL_SYSTEMIMAGE_DEPS) $(INSTALLED_FILES_FILE)                 //5级目标  
    $(call build-systemimage-target,$@)


BUILT_USERDATAIMAGE_TARGET := $(PRODUCT_OUT)/userdata.img
INSTALLED_USERDATAIMAGE_TARGET := $(BUILT_USERDATAIMAGE_TARGET)
INTERNAL_USERDATAIMAGE_FILES := \                                                      //4级目标
    $(filter $(TARGET_OUT_DATA)/%,$(ALL_DEFAULT_INSTALLED_MODULES))

$(INSTALLED_USERDATAIMAGE_TARGET): $(INTERNAL_USERIMAGES_DEPS) \                       //3级目标
                               $(INTERNAL_USERDATAIMAGE_FILES)
    $(build-userdataimage-target)

define build-userdataimage-target  //做userdata.img分区build操作
  $(call pretty,&quot;Target userdata fs image: $(INSTALLED_USERDATAIMAGE_TARGET)&quot;)
  @mkdir -p $(TARGET_OUT_DATA)
  @mkdir -p $(userdataimage_intermediates) &amp;&amp; rm -rf $(userdataimage_intermediates)/userdata_image_info.txt
  $(call generate-userimage-prop-dictionary, $(userdataimage_intermediates)/userdata_image_info.txt, skip_fsck=true)
  $(hide) PATH=$(foreach p,$(INTERNAL_USERIMAGES_BINARY_PATHS),$(p):)$$PATH \
      ./build/tools/releasetools/build_image.py \
      $(TARGET_OUT_DATA) $(userdataimage_intermediates)/userdata_image_info.txt $(INSTALLED_USERDATAIMAGE_TARGET)
  $(hide) $(call assert-max-image-size,$(INSTALLED_USERDATAIMAGE_TARGET),$(BOARD_USERDATAIMAGE_PARTITION_SIZE))
endef


注 system.img userdata.img 会依赖skip_userdata.img := 这个变量 及 嵌套依赖device/.../BoardConfig.mk中的TARGET_USERIMAGES_USE_EXT4、BOARD_SYSTEMIMAGE_PARTITION_SIZE、BOARD_USERDATAIMAGE_PARTITION_SIZE和
</code></pre><h2 id="image解压方法"><a href="#image解压方法" class="headerlink" title="image解压方法"></a>image解压方法</h2><pre><code>ramdisk.img   用file命令查看显示ramdisk.img: gzip compressed data, from Unix，采用cpio打包，gzip压缩的
    cp -a ramdisk.img 000/ramdisk.img.gz
    cd 000/
    gunzip ramdisk.img.gz //得到ramdisk.img 文件，但是和原始的ramdisk.img是不一样的，大小要大不少
    mkdir root
    cd root
    cpio –i -F ../ramdisk.img

system.img    用file命令查看显示system.img: data
    cp -a system.img 000/system.img
    cd 000/
    out/host/linux-x86/bin/simg2img system.img system.ext4.img //用simg2img工具把system.img转为为ext4文件格式
    mkdir system                                       //建立system目录
    sudo mount -t ext4 -o loop system.ext4.img system  //将ext4格式的镜像挂在到system目录

userdata.img  用file命令查看显示userdata.img: data
    同system.img

recovery.img  用file命令查看显示recovery.img: data
    需要使用外部工具https://github.com/xiaolu/mkbootimg_tools.git  mkboot命令
    ./mkbootimg_tools/mkboot recovery.img recovery

boot.img      用file命令查看显示boot.img: data
    需要使用外部工具https://github.com/xiaolu/mkbootimg_tools.git  mkboot命令
    ./mkbootimg_tools/mkboot boot.img boot 
</code></pre><h2 id="image压缩方法"><a href="#image压缩方法" class="headerlink" title="image压缩方法"></a>image压缩方法</h2><pre><code>a. ramdisk 使用cpio -o -H | gzip 生成ramdisk.img
b. system userdata recovery都可以使用mkuserimg.sh来压缩成镜像
   mkuserimg.sh -s 镜像源目录 镜像输出文件 ext4 挂在点 分区size FILE_CONTEXTS文件
</code></pre><h2 id="单独编译image"><a href="#单独编译image" class="headerlink" title="单独编译image"></a>单独编译image</h2><pre><code>make systemimage - system.img
make userdataimage - userdata.img
make ramdisk - ramdisk.img
make snod - 快速打包system.img (with this command, it will build a new system.img very quickly. 
            well, you cannot use &quot;make snod&quot; for all the situations. it would not check the dependences. 
            if you change some code in the framework which will effect other applications)
</code></pre><h2 id="附"><a href="#附" class="headerlink" title="附:"></a>附:</h2><pre><code>simg2img解压缩工具: Convert Android sparse images to raw images. 在out/host/linux-x86/bin/simg2img可以找到
用法：simg2img &lt;sparse_image_files&gt; &lt;raw_image_file&gt;

mkuserimg.sh镜像制作工具，在out/host/linux-x86/bin/mkuserimg.sh可以找到，工具中会调用make_ext4fs
用法：mkuserimg.sh [-s] SRC_DIR OUTPUT_FILE EXT_VARIANT MOUNT_POINT SIZE [-j &lt;journal_size&gt;]
         [-T TIMESTAMP] [-C FS_CONFIG] [-B BLOCK_LIST_FILE] [FILE_CONTEXTS]

    例如制作system.img和userdata.img时：
    Running:  mkuserimg.sh -s out/target/product/rk3368_box/system out/target/product/rk3368_box/obj/PACKAGING/systemimage_intermediates/system.img ext4 system 1073741824 out/target/product/rk3368_box/root/file_contexts
    make_ext4fs -s -T -1 -S out/target/product/rk3368_box/root/file_contexts -l 1073741824 -a system out/target/product/rk3368_box/obj/PACKAGING/systemimage_intermediates/system.img out/target/product/rk3368_box/system

    Running:  mkuserimg.sh -s out/target/product/rk3368_box/data out/target/product/rk3368_box/userdata.img ext4 data 2147483648 out/target/product/rk3368_box/root/file_contexts
    make_ext4fs -s -T -1 -S out/target/product/rk3368_box/root/file_contexts -l 2147483648 -a data out/target/product/rk3368_box/userdata.img out/target/product/rk3368_box/data

make_ext4fs工具：用于Android平台上制作ext4文件系统的镜像，在out/host/linux-x86/bin/make_ext4fs
用法：make_ext4fs [ -l &lt;len&gt; ] [ -j &lt;journal size&gt; ] [ -b &lt;block_size&gt; ]
                 [ -g &lt;blocks per group&gt; ] [ -i &lt;inodes&gt; ] [ -I &lt;inode size&gt; ]
                 [ -L &lt;label&gt; ] [ -f ] [ -a &lt;android mountpoint&gt; ]
                 [ -S file_contexts ] [ -C fs_config ] [ -T timestamp ]
                 [ -z | -s ] [ -w ] [ -c ] [ -J ] [ -v ] [ -B &lt;block_list_file&gt; ] &lt;filename&gt; [&lt;directory&gt;]
        -l 分区大小 支持512M 以及1073741824 单位为bytes
        -s 生成ext4的S模式制作
        -T timestamp  // -1 mean what? fix me
        -a 挂在点
        -S  file_contexts文件
        &lt;filename&gt;  生成的目的文件
        &lt;directory&gt; 源文件目录
</code></pre><h2 id="附2——一般Android系统的boot-img格式-RK平台的boot-img是没包含kernel部分的"><a href="#附2——一般Android系统的boot-img格式-RK平台的boot-img是没包含kernel部分的" class="headerlink" title="附2——一般Android系统的boot.img格式(RK平台的boot.img是没包含kernel部分的)"></a>附2——一般Android系统的boot.img格式(RK平台的boot.img是没包含kernel部分的)</h2><pre><code>因为boot.img的格式比较简单，它主要分为三大块（有的可能有四块）

+—————–+
| boot header | 1 page
+—————–+
| kernel | n pages
+—————–+
| ramdisk | m pages
+—————–+
| second stage | o pages
+—————–+
n = (kernel_size + page_size – 1) / page_size
m = (ramdisk_size + page_size – 1) / page_size
o = (second_size + page_size – 1) / page_size

a. all entities are page_size aligned in flash
b. kernel and ramdisk are required (size != 0)
c. second is optional (second_size == 0 -&gt; no second)
</code></pre>
      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/image/">image</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/编译/">编译</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-RK平台分区信息"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/11/RK平台分区信息/">RK平台分区信息</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/11/RK平台分区信息/" class="article-date">
	  <time datetime="2017-04-11T09:35:57.000Z" itemprop="datePublished">2017-04-11</time>
	</a>

      
    <a class="article-category-link" href="/categories/RK/">RK</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="RK平台分区信息与eMMC-partitions对应"><a href="#RK平台分区信息与eMMC-partitions对应" class="headerlink" title="RK平台分区信息与eMMC partitions对应"></a>RK平台分区信息与eMMC partitions对应</h2><pre><code>lrwxrwxrwx root     root    2013-01-21 08:50 uboot            -&gt; /dev/block/mmcblk0p1
lrwxrwxrwx root     root    2013-01-21 08:50 trust            -&gt; /dev/block/mmcblk0p2
lrwxrwxrwx root     root    2013-01-21 08:50 misc             -&gt; /dev/block/mmcblk0p3
lrwxrwxrwx root     root    2013-01-21 08:50 resource         -&gt; /dev/block/mmcblk0p4
lrwxrwxrwx root     root    2013-01-21 08:50 kernel           -&gt; /dev/block/mmcblk0p5
lrwxrwxrwx root     root    2013-01-21 08:50 boot             -&gt; /dev/block/mmcblk0p6
lrwxrwxrwx root     root    2013-01-21 08:50 recovery         -&gt; /dev/block/mmcblk0p7
lrwxrwxrwx root     root    2013-01-21 08:50 backup           -&gt; /dev/block/mmcblk0p8
lrwxrwxrwx root     root    2013-01-21 08:50 cache            -&gt; /dev/block/mmcblk0p9
lrwxrwxrwx root     root    2013-01-21 08:50 kpanic           -&gt; /dev/block/mmcblk0p10
lrwxrwxrwx root     root    2013-01-21 08:50 system           -&gt; /dev/block/mmcblk0p11
lrwxrwxrwx root     root    2013-01-21 08:50 metadata         -&gt; /dev/block/mmcblk0p12
lrwxrwxrwx root     root    2013-01-21 08:50 baseparamer      -&gt; /dev/block/mmcblk0p13
lrwxrwxrwx root     root    2013-01-21 08:50 userdata         -&gt; /dev/block/mmcblk0p14
lrwxrwxrwx root     root    2013-01-21 08:50 radical_update   -&gt; /dev/block/mmcblk0p15
lrwxrwxrwx root     root    2013-01-21 08:50 user             -&gt; /dev/block/mmcblk0p16

mmcblk0: p1 p2 p3 p4 p5 p6 p7 p8 p9 p10 p11 p12 p13 p14 p15 p16 p17

/mnt/external_sd vfat                                            /dev/block/mmcblk1p1
</code></pre><h2 id="RK平台各分区介绍"><a href="#RK平台各分区介绍" class="headerlink" title="RK平台各分区介绍"></a>RK平台各分区介绍</h2><pre><code>uboot.img
trust.img
misc.img      RK平台，misc分区内容用于启动模式切换，是升级基带还是进入Recovery（misc分区的内容可以被按键出发改变???）
resource.img  RK平台资源映像，内含开机图片和内核的设备树信息。
kernel
boot.img      Android 的初始文件映像，负责初始化并加载 system 分区，一般Android系统这个镜像中包含ramdisk.img根文件系统+kernel（RK平台的boot.img是没包含kernel部分的）
    ramdisk.img   是根文件系统，是root目录打包成的镜像（ramdisk-recovery.img）
recovery.img  恢复模式系统启动镜像。内容和boot.img雷同（RK平台recovery.img包含kernel部分），但是其中的ramdisk.img（ramdisk-recovery.img）有些许不同：
              recovery.fstab文件、sbin下部分工具、build.prop、init.bootmode.emmc.rc、sepolicy等
backup
cache
kpanic

system.img    包括了主要的包、库等文件
metadata
baseparameter
userdata.img  包括了一些用户数据
radical_update
user
</code></pre><h2 id="另："><a href="#另：" class="headerlink" title="另："></a>另：</h2><pre><code>RK平台生成boot.img recovery.img system.img userdata.img是使用自己的mkimage.sh工具讲root system data 目录生成的
再使用工具mkupdate.sh生成update.img的（不带userdata.img）
烧写userdata.img 需要使用./upgrade_tool DI userdata userdata.img 单独烧写
</code></pre>
      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RK/">RK</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分区/">分区</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-RK平台Android分区大小修改说明"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/11/RK平台Android分区大小修改说明/">RK平台Android分区大小修改说明</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/11/RK平台Android分区大小修改说明/" class="article-date">
	  <time datetime="2017-04-11T01:01:57.000Z" itemprop="datePublished">2017-04-11</time>
	</a>

      
    <a class="article-category-link" href="/categories/Android/">Android</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>不同于一般的Android系统（一般Android系统分区信息在BoardConfig.mk BoardConfigCommon.mk中），RK平台的分区信息文件在自带的烧录工具包中的parameter文件中</p>
<h6 id="如下是板子的parameter文件"><a href="#如下是板子的parameter文件" class="headerlink" title="如下是板子的parameter文件:"></a>如下是板子的parameter文件:</h6><pre><code>FIRMWARE_VER: 5.1.0
MACHINE_MODEL: Geekbox
MACHINE_ID: 007
MANUFACTURER: RK3368
MAGIC: 0x5041524B
ATAG: 0x00200800
MACHINE: 3368
CHECK_MASK: 0x80
PWR_HLD: 0,0,A,0,1
#KERNEL_IMG: 0x00280000
#FDT_NAME: rk-kernel.dtb
#RECOVER_KEY: 1,1,0,20,0
#in section; per section 512(0x200) bytes
CMDLINE: console=ttyS2 androidboot.baseband=N/A androidboot.selinux=permissive androidboot.hardware=rk30board androidboot.console=ttyS2 init=/init mtdparts=rk29xxnand:0x00002000@0x00002000(uboot),0x00002000@0x00004000(trust),0x00002000@0x00006000(misc),0x00008000@0x00008000(resource),0x00008000@0x00010000(kernel),0x00010000@0x00018000(boot),0x00010000@0x00028000(recovery),0x00038000@0x00038000(backup),0x00040000@0x00070000(cache),0x00002000@0x000B0000(kpanic),0x00200000@0x000B2000(system),0x00008000@0x002B2000(metadata),0x00002000@0x002BA000(baseparamer),0x00400000@0x002BC000(userdata),0x00020000@0x006BC000(radical_update),-@0x006DC000(user)
</code></pre><p>分区信息在mtdparts=rk29xxnand:字段后面部分，所以我们修改这部分内容就可以了</p>
<h6 id="这部分信息格式介绍-如："><a href="#这部分信息格式介绍-如：" class="headerlink" title="这部分信息格式介绍 如："></a>这部分信息格式介绍 如：</h6><pre><code>0x00002000@0x00002000(uboot)  分区大小计算为=0x00002000*512Bytes = 4MBytes
↑分区的sector数，每个sector=512Bytes
           ↑分区起始地址
                      ↑分区名

0x00200000@0x002BC000(userdata)  分区大小0x00200000*512Bytes = 1073741824 Bytes

注: sector 512Bytes 逻辑单位???
    page: FLASH操作的基本单位。  最小读/写单元 page， 1page = 4096Bytes = 4KB；
    block:最小擦除单元 block，1block = (32 * page) = (32 * 4KB) = 131072Bytes = 128KB；     
</code></pre><p>上述mtdparts=rk29xxnand:字段中所有分区都是连续的，当前分区起始地址+当前分区size和下个分区起始地址都是连续的，所以当修改了其中某个分区后，在它后面的分区的地址都要顺序往前或往后。</p>
<h6 id="以下是我将userdata分区缩小为1GB，将user分区扩大1GB的例子："><a href="#以下是我将userdata分区缩小为1GB，将user分区扩大1GB的例子：" class="headerlink" title="以下是我将userdata分区缩小为1GB，将user分区扩大1GB的例子："></a>以下是我将userdata分区缩小为1GB，将user分区扩大1GB的例子：</h6><pre><code>修改前:                            size             offset
0x00002000@0x00000000(parameter)//4MB               4MB
0x00002000@0x00002000(uboot),   //4MB               8MB
0x00002000@0x00004000(trust),   //4MB               12MB
0x00002000@0x00006000(misc),    //4MB               16MB
0x00008000@0x00008000(resource),//16MB              32MB
0x00008000@0x00010000(kernel),  //16MB              48
0x00010000@0x00018000(boot),    //32MB              80
0x00010000@0x00028000(recovery),//32MB              112
0x00038000@0x00038000(backup),  //112MB             224
0x00040000@0x00070000(cache),   //128MB             352
0x00002000@0x000B0000(kpanic),  //4MB               356
0x00200000@0x000B2000(system),  //1024MB            1380
0x00008000@0x002B2000(metadata),//16MB              1396
0x00002000@0x002BA000(baseparamer), //4MB           1400MB
0x00400000@0x002BC000(userdata),    //2048MB        3448
0x00020000@0x006BC000(radical_update), //64MB       3512
         -@0x006DC000(user)            //212MB/11394MB  ...        

修改后:
0x00002000@0x00002000(uboot),   //4MB               8MB
0x00002000@0x00004000(trust),   //4MB               12MB
0x00002000@0x00006000(misc),    //4MB               16MB
0x00008000@0x00008000(resource),//16MB              32MB
0x00008000@0x00010000(kernel),  //16MB              48
0x00010000@0x00018000(boot),    //32MB              80
0x00010000@0x00028000(recovery),//32MB              112
0x00038000@0x00038000(backup),  //112MB             224
0x00040000@0x00070000(cache),   //128MB             352
0x00002000@0x000B0000(kpanic),  //4MB               356
0x00200000@0x000B2000(system),  //1024MB            1380
0x00008000@0x002B2000(metadata),//16MB              1396
0x00002000@0x002BA000(baseparamer), //4MB           1400MB
0x00200000@0x002BC000(userdata),    //1024MB        2424MB
0x00020000@0x004BC000(radical_update), //64MB       2488MB
         -@0x004DC000(user)            //1024+212MB = 1236MB   
</code></pre><h5 id="注："><a href="#注：" class="headerlink" title="注："></a>注：</h5><pre><code>1.分区的大小要以4MB对齐！  
2.分区总大小不能超过flash的总长度
</code></pre><h5 id="修改parameter后效果："><a href="#修改parameter后效果：" class="headerlink" title="修改parameter后效果："></a>修改parameter后效果：</h5><pre><code>shell@rk3368_32:/ # df
Filesystem               Size     Used     Free   Blksize
/dev                   495.2M    36.0K   495.2M   4096
/sys/fs/cgroup         495.2M    12.0K   495.2M   4096
/mnt/asec              495.2M     0.0K   495.2M   4096
/mnt/obb               495.2M     0.0K   495.2M   4096
/system               1004.2M   403.0M   601.2M   4096
/cache                 122.0M   140.0K   121.8M   4096
/metadata               11.7M    40.0K    11.7M   4096
/data                  991.9M    87.5M   904.4M   4096
/mnt/shell/emulated    991.9M    87.5M   904.4M   4096
/mnt/internal_sd         1.2G   136.0K     1.2G   8192
/mnt/secure/asec         1.2G   136.0K     1.2G   8192
</code></pre><h3 id="一般Android平台分区修改"><a href="#一般Android平台分区修改" class="headerlink" title="一般Android平台分区修改"></a>一般Android平台分区修改</h3><pre><code>eMMC 分区信息
# cat /proc/partitions                                       
major      minor  #blocks  name
 254        0     520912   zram0
 179        0   15267840   mmcblk0
 179        1       4096   mmcblk0p1
 179        2       4096   mmcblk0p2
 179        3       4096   mmcblk0p3
 179        4      16384   mmcblk0p4
 179        5      16384   mmcblk0p5
 179        6      32768   mmcblk0p6
 179        7      32768   mmcblk0p7
 179        8     114688   mmcblk0p8
 179        9     131072   mmcblk0p9
 179       10       4096   mmcblk0p10
 179       11    1048576   mmcblk0p11
 179       12      16384   mmcblk0p12
 179       13       4096   mmcblk0p13
 179       14    2097152   mmcblk0p14
 179       15      65536   mmcblk0p15
 179       16   11667456   mmcblk0p16
mmcblk0即emmc的容量（单位kb）

#ls /dev/block/platform/ff0f0000.rksdmmc/by-name/* -l 
lrwxrwxrwx root     root    2013-01-21 08:50 uboot            -&gt; /dev/block/mmcblk0p1
lrwxrwxrwx root     root    2013-01-21 08:50 trust            -&gt; /dev/block/mmcblk0p2
lrwxrwxrwx root     root    2013-01-21 08:50 misc             -&gt; /dev/block/mmcblk0p3
lrwxrwxrwx root     root    2013-01-21 08:50 resource         -&gt; /dev/block/mmcblk0p4
lrwxrwxrwx root     root    2013-01-21 08:50 kernel           -&gt; /dev/block/mmcblk0p5
lrwxrwxrwx root     root    2013-01-21 08:50 boot             -&gt; /dev/block/mmcblk0p6
lrwxrwxrwx root     root    2013-01-21 08:50 recovery         -&gt; /dev/block/mmcblk0p7
lrwxrwxrwx root     root    2013-01-21 08:50 backup           -&gt; /dev/block/mmcblk0p8
lrwxrwxrwx root     root    2013-01-21 08:50 cache            -&gt; /dev/block/mmcblk0p9
lrwxrwxrwx root     root    2013-01-21 08:50 kpanic           -&gt; /dev/block/mmcblk0p10
lrwxrwxrwx root     root    2013-01-21 08:50 system           -&gt; /dev/block/mmcblk0p11
lrwxrwxrwx root     root    2013-01-21 08:50 metadata         -&gt; /dev/block/mmcblk0p12
lrwxrwxrwx root     root    2013-01-21 08:50 baseparamer      -&gt; /dev/block/mmcblk0p13
lrwxrwxrwx root     root    2013-01-21 08:50 userdata         -&gt; /dev/block/mmcblk0p14
lrwxrwxrwx root     root    2013-01-21 08:50 radical_update   -&gt; /dev/block/mmcblk0p15
lrwxrwxrwx root     root    2013-01-21 08:50 user             -&gt; /dev/block/mmcblk0p16


即userdata 分区 大小为2097152*1024KB = 2147483648B

BoardConfig.mk 中修改指定变量即可：
BOARD_BOOTIMAGE_PARTITION_SIZE := 16777216
BOARD_RECOVERYIMAGE_PARTITION_SIZE := 16793600
BOARD_SYSTEMIMAGE_PARTITION_SIZE := 2147483648
BOARD_OEMIMAGE_PARTITION_SIZE := 67108864
BOARD_USERDATAIMAGE_PARTITION_SIZE := 25253773312 ---&gt; 2147483648B
BOARD_CACHEIMAGE_PARTITION_SIZE := 268435456
BOARD_CACHEIMAGE_FILE_SYSTEM_TYPE := ext4
BOARD_FLASH_BLOCK_SIZE := 131072
</code></pre>
      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RK/">RK</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/分区/">分区</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-Other_Hexo入手"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/04/07/Other_Hexo入手/">Hexo入手</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/04/07/Other_Hexo入手/" class="article-date">
	  <time datetime="2017-04-07T10:01:57.000Z" itemprop="datePublished">2017-04-07</time>
	</a>

      
    <a class="article-category-link" href="/categories/杂项/">杂项</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-安装nodejs"><a href="#1-安装nodejs" class="headerlink" title="1. 安装nodejs"></a>1. 安装nodejs</h4><pre><code>从官网下载对应平台binary 包，安装（linux直接将bin lib目录的文件cp到usr/local对应目录下，Window直接点击安装）
</code></pre><h4 id="2-安装hexo"><a href="#2-安装hexo" class="headerlink" title="2. 安装hexo"></a>2. 安装hexo</h4><pre><code>npm install hexo-cli -g
</code></pre><h4 id="3-新建blog"><a href="#3-新建blog" class="headerlink" title="3. 新建blog"></a>3. 新建blog</h4><pre><code>hexo init blog
cd blog
npm install
hexo server
</code></pre><h4 id="3-解决一个warning"><a href="#3-解决一个warning" class="headerlink" title="3. 解决一个warning"></a>3. 解决一个warning</h4><pre><code>npm install -g npm@3.3.12
npm install hexo-deployer-git --save
</code></pre><h4 id="4-配置-config-yml"><a href="#4-配置-config-yml" class="headerlink" title="4. 配置_config.yml"></a>4. 配置_config.yml</h4><pre><code>language: zh-CN
deploy:
  type: git
  repo: &lt;repository url&gt;
  branch: [branch]
  message: [message]
</code></pre><h4 id="5-部署"><a href="#5-部署" class="headerlink" title="5. 部署"></a>5. 部署</h4><pre><code>hexo deploy -generate   //hexo d -g 
</code></pre><h4 id="附（参考）"><a href="#附（参考）" class="headerlink" title="附（参考）"></a>附（参考）</h4><p><a href="https://hexo.io/docs/index.html" target="_blank" rel="external">https://hexo.io/docs/index.html</a></p>

      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网页博客/">网页博客</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2012 - 2017 进无止境&#39;s 博客 All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				<span id="busuanzi_container_site_uv"> 访客数 : <span id="busuanzi_value_site_uv"></span></span> |  
				<span id="busuanzi_container_site_pv"> 访问量 : <span id="busuanzi_value_site_pv"></span></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    


  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>


  <script src="/js/home.js"></script>








  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            进无止境&#39;s 博客
          </div>
          <div class="panel-body">
            Copyright © 2017 Jim All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  

	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


</body>
</html>